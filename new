# Define Key Vault Name
$KeyVaultName = "<Your-KeyVault-Name>"

# Get all secret names
$secrets = az keyvault secret list --vault-name $KeyVaultName --query "[].{Name:name}" --output json | ConvertFrom-Json

# Create an array to store secret names and values
$secretList = @()

# Loop through each secret to get its value
foreach ($secret in $secrets) {
    $secretValue = az keyvault secret show --vault-name $KeyVaultName --name $secret.Name --query "value" --output tsv
    $secretList += [PSCustomObject]@{
        Name  = $secret.Name
        Value = $secretValue
    }
}

# Export to Excel
$ExcelFilePath = "$PSScriptRoot\KeyVaultSecrets.xlsx"
$secretList | Export-Excel -Path $ExcelFilePath -AutoSize -Title "Azure Key Vault Secrets"

Write-Host "Export completed: $ExcelFilePath"
